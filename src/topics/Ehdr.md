## elf head

> `ELF`（`Executable and Linkable Format`）是一种可执行文件和可链接文件的格式标准，广泛用于`UNIX`和类`UNIX`系统上。`ELF`文件以其头部（`ELF header`）开头，它描述了`ELF`文件的结构和属性。

`ELF`头部是`ELF`文件的第一个部分，由以下结构组成：

```c++
typedef struct {
    unsigned char e_ident[16]; // 标识符，用于识别ELF文件类型
    uint16_t e_type;           // 文件类型
    uint16_t e_machine;        // 目标硬件架构
    uint32_t e_version;        // 文件版本号
    uint64_t e_entry;          // 程序入口点的虚拟地址
    uint64_t e_phoff;          // 程序头部表的文件偏移量
    uint64_t e_shoff;          // 节头部表的文件偏移量
    uint32_t e_flags;          // 处理器特定标志
    uint16_t e_ehsize;         // ELF头部的大小
    uint16_t e_phentsize;      // 程序头部表中每个条目的大小
    uint16_t e_phnum;          // 程序头部表中条目的数量
    uint16_t e_shentsize;      // 节头部表中每个条目的大小
    uint16_t e_shnum;          // 节头部表中条目的数量
    uint16_t e_shstrndx;       // 字符串表在节头部表中的索引
} Elf64_Ehdr;
```
以上是用于描述`64`位`ELF`文件的`Elf64_Ehdr`结构体，对应`32`位的是`Elf32_Ehdr`。

`ELF`头部的各个字段包含了文件的关键信息，例如文件类型、目标硬件架构、入口点地址、程序头部表和节头部表的偏移和大小等。通过解析`ELF`头部，可以了解文件的结构、属性和依赖关系，从而正确加载和执行`ELF`文件。

注意：`ELF`头部的具体结构和字段含义可能会因为不同的目标系统和`ELF`文件类型而有所不同。以上是`64`位`ELF`文件的一般格式，具体实现还需根据目标系统的文档和规范来确定。


### 魔数（Magic Number）：用于识别文件是否为ELF格式。
`e_ident`是`ELF`头部结构中的一个字段，用于标识和识别`ELF`文件的类型和属性。它是一个包含`16`个字节的数组，用于存储特定的标识符。

`ELF`标识符数组`e_ident`的各个元素含义如下：

+ `EI_MAG0` (0) 和 `EI_MAG1` (1): 用于确定文件的魔数（`Magic Number`），其取值为`0x7F`和`0x45`，对应ASCII码中的"\L"。
+ `EI_MAG2` (2) 和 `EI_MAG3` (3): 魔数的后续两个字节，取值为`0x4C`和`0x46`，对应ASCII码中的"L"和"F"。
+ `EI_CLASS` (4): 指定`ELF`文件的位数，取值为`1`表示`32`位文件，取值为`2`表示`64`位文件。
+ `EI_DATA` (5): 指定`ELF`文件中数据的字节序，取值为`1`表示小端字节序 (`Little Endian`)，取值为`2`表示大端字节序 (`Big Endian`)。
+ `EI_VERSION` (6): 指定`ELF`文件的版本号，通常为`1`。
+ `EI_OSABI` (7): 指定操作系统和`ABI` (`Application Binary Interface`) 的标识符。不同的操作系统和`ABI`可能有不同的取值，常见的取值包括0表示未指定的`OS`或`ABI`、`3`表示`Linux`、`9`表示可移植操作系统接口 (`POSIX`) 等。
+ `EI_ABIVERSION` (8): 对于与特定`ABI`相关的版本号，对大多数`OS`和`ABIs`而言，该值为0。
+ `EI_PAD (9-15)`: 未使用的保留字节，用于使`e_ident`数组的长度达到`16`个字节。
通过读取`ELF`文件的`e_ident`字段，可以判断文件的类型、位数、字节序以及所属的操作系统和`ABI`等信息，从而正确解析和处理`ELF`文件。

魔数（Magic Number）：用于识别文件是否为ELF格式。


### 类型（Type）：标识文件的类型，如可执行文件、共享库等

`e_type`是一个`uint16_t`类型的字段，用于表示`ELF`文件的类型。它指定了`ELF`文件是可执行文件、共享目标文件、核心转储文件还是其他类型。

在`ELF`头部中，`e_type`字段是`2`个字节（`16`位）大小，存储在相应的偏移量处。具体数值代表的含义如下：

+ `ET_NONE` (0)：无效类型
+ `ET_REL` (1)：可重定位文件
+ `ET_EXEC` (2)：可执行文件
+ `ET_DYN` (3)：共享目标文件
+ `ET_CORE` (4)：核心转储文件
+ `ET_LOOS` (0xfe00) 到 `ET_HIOS` (0xfeff)：操作系统特定的类型
+ `ET_LOPROC` (0xff00) 到 `ET_HIPROC` (0xffff)：处理器特定的类型
这些类型为操作系统和处理器提供了对于`ELF`文件的基本信息，以便正确加载和执行文件。

### 架构（Machine）：指定目标处理器的体系结构。
`e_machine`是一个`uint16_t`类型的字段，用于表示`ELF`文件的目标硬件架构。它指定了该`ELF`文件将在哪种硬件架构上运行。

在`ELF`头部中，`e_machine`字段是`2`个字节（`16`位）大小，存储在相应的偏移量处。具体数值代表的含义因不同的硬件架构而异。下面是一些常见的`e_machine`值及其对应的架构：

+ `EM_NONE` (0)：未指定架构
+ `EM_M32` (1)：AT&T WE 32100
+ `EM_SPARC` (2)：SPARC
+ `EM_386` (3)：Intel 80386
+ `EM_ARM` (40)：ARM
+ `EM_X86_64` (62)：AMD x86-64
+ `EM_AARCH64` (183)：ARM AArch64

这些数值代表了不同的硬件架构类型，用于指示操作系统或加载器在加载和执行 ELF 文件时正确处理二进制指令集和硬件特定的细节。

### 版本（Version）：指定ELF文件的版本。

`e_version` 是一个`uint32_t`类型的字段，用于表示`ELF`文件的版本号。它指定了`ELF`文件所遵循的`ELF`标准的版本。

在`ELF`头部中，`e_version`字段是`4`个字节（`32`位）大小，存储在相应的偏移量处。具体数值代表的含义如下：

+ `EV_NONE` (0)：无效版本
+ `EV_CURRENT` (1)：当前`ELF`标准的版本
+ `EV_CURRENT` 表示该`ELF`文件遵循当前的`ELF`标准版本。版本号的目的是确保加载和处理`ELF`文件时使用正确的解析规则和工作流程。

请注意，不同的`ELF`格式可能会定义其他特定的版本号。这些特定的版本号可能与操作系统、工具链或其他相关因素有关。因此，在特定环境中，可以出现不同于`EV_CURRENT`的自定义版本号。

### 入口点地址（Entry Point Address）：程序执行的起始地址。

`e_entry`是一个`uint64_t`类型的字段，用于表示`ELF`文件的程序入口点的虚拟地址。它指定了程序在内存中开始执行的地址。

在`ELF`头部中，`e_entry`字段是`8`个字节（`64`位）大小，存储在相应的偏移量处。它记录了程序的起始执行点的虚拟地址。

这个虚拟地址可以看作是程序加载到内存后，处理器从该地址开始执行指令的位置。对于可执行文件，这个地址通常是程序的`main`函数或其他初始执行代码的入口点。

需要注意的是，不同的目标硬件架构和操作系统可能有不同的内存布局和地址分配方式，因此具体的虚拟地址值会根据具体的系统和环境而有所不同。

### 程序头表偏移量（Program Header Table Offset）：指向程序头表的偏移量。

`e_phoff`是一个`uint64_t`类型的字段，用于表示`ELF`文件中程序头部表（`Program Header Table`）的文件偏移量。它指定了程序头部表在`ELF`文件中的位置。

在`ELF`头部中，`e_phoff`字段是`8`个字节（`64` 位）大小，存储在相应的偏移量处。它记录了程序头部表相对于`ELF`文件开头的偏移量。

程序头部表是一个重要的数据结构，它包含了描述`ELF`文件中各个段（segment）的元数据，如加载地址、内存偏移量、文件偏移量、段的大小等信息。通过解析程序头部表，操作系统或加载器可以知道如何正确地加载和执行`ELF`文件中的各个段。

`e_phoff`字段的值表示程序头部表在`ELF`文件中的位置，以字节为单位。通过读取该值并根据需要解析对应的程序头部表项，可以获取到关于各个段的详细信息。

### 节区头表偏移量（Section Header Table Offset）：指向节区头表的偏移量。

变量 `e_shoff` 用于存储`ELF`（可执行和可链接格式）文件中节头部表的文件偏移量。类型`uint64_t`表示它是一个无符号的`64`位整数。

### 标志（Flags）：用于指定额外的属性和特征。

变量`e_flags`用于存储与处理器特定标志相关的信息。它是一个`32`位的无符号整数类型`uint32_t`。这些标志可能因处理器架构而异，用于指定与程序执行环境和处理器相关的特性或要求。

### 头部大小（Header Size）：ELF头部的大小。

变量`e_ehsize`用于存储`ELF`（可执行和可链接格式）头部的大小。它是一个`16`位的无符号整数类型`uint16_t`。ELF头部是一个固定大小的结构，包含了文件格式、机器架构、入口点地址等信息。`e_ehsize`表示 `ELF`头部的字节大小。

### 程序头表项大小（Program Header Entry Size）：每个程序头表项的大小。

变量`e_phentsize`用于存储程序头部表中每个条目的大小。它是一个`16`位的无符号整数类型`uint16_t`。程序头部表包含了描述可执行文件中各个段（`segment`）的信息，每个条目对应一个段。`e_phentsize`表示每个程序头部表条目的字节大小。

### 程序头表项数量（Program Header Entry Count）：程序头表中的条目数量。

变量`e_phnum`用于存储程序头部表中条目的数量。它是一个`16`位的无符号整数类型`uint16_`。程序头部表包含了描述可执行文件中各个段（`segment`）的信息，每个段对应一个条目。`e_phnum`表示程序头部表中的条目数量，即可执行文件中段的个数。

### 节区头表项大小（Section Header Entry Size）：每个节区头表项的大小。

变量`e_shentsize`用于存储节头部表中每个条目的大小。它是一个`16`位的无符号整数类型`uint16_t`。节头部表包含了描述可执行文件中各个节（`section`）的信息，每个条目对应一个节。`e_shentsize`表示每个节头部表条目的字节大小。

### 节区头表项数量（Section Header Entry Count）：节区头表中的条目数量。

变量`e_shnum`用于存储节头部表中条目的数量。它是一个`16`位的无符号整数类型`uint16_t`。节头部表包含了描述可执行文件中各个节（`section`）的信息，每个节对应一个条目。`e_shnum`表示节头部表中的条目数量，即可执行文件中节的个数。

### 字符串表索引（String Table Index）：用于定位字符串表的索引。

变量`e_shstrndx`用于存储字符串表在节头部表中的索引。它是一个`16`位的无符号整数类型`uint16_t`。在`ELF`（可执行和可链接格式）文件中，节头部表中有一个特殊的节称为字符串表节，用于存储各个节名的字符串。`e_shstrndx`表示字符串表节在节头部表中的索引值，通过该索引可以找到字符串表节的信息。



